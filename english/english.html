<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Police Exam Master: ‡∏ï‡∏¥‡∏ß‡∏™‡∏≠‡∏ö‡∏ô‡∏≤‡∏¢‡∏™‡∏¥‡∏ö‡∏ï‡∏≥‡∏£‡∏ß‡∏à</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #2c3e50;
            --primary-light: #34495e;
            --accent: #e67e22;
            --highlight: #3498db;
            --correct: #27ae60;
            --wrong: #c0392b;
            --bg: #e9ecef;
            --card-bg: #ffffff;
            --purple: #9b59b6;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #333;
        }

        .app-container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px;
            height: auto;
            min-height: 500px;
            max-height: 95vh;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .header {
            background: var(--primary-dark);
            color: white;
            padding: 15px;
            text-align: center;
            flex-shrink: 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header h1 { margin: 0; font-size: 20px; font-weight: 700; }
        .header p { margin: 2px 0 0; font-size: 13px; opacity: 0.8; }

        .content-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            scrollbar-width: thin;
        }

        .screen { display: none; animation: fadeIn 0.3s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Buttons */
        .btn {
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Sarabun', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn:active { transform: scale(0.98); }
        
        .btn-main { background-color: var(--highlight); color: white; }
        .btn-start { background-color: var(--correct); color: white; font-size: 18px; padding: 15px; }
        .btn-analysis { background-color: var(--purple); color: white; }
        .btn-back { background-color: #95a5a6; color: white; margin-top: 15px; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Restore Feature) */
        .btn-rec { 
            background-color: var(--wrong); 
            color: white; 
            padding: 15px;
            font-size: 18px;
            animation: pulse 2s infinite; 
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ */
        .btn-next {
            background-color: var(--primary-dark);
            color: white;
            padding: 15px;
            font-size: 18px;
            margin-top: 15px;
            animation: bounce 1s infinite;
            display: none;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }

        /* Menu Grid */
        .grid-menu {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .menu-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .menu-card:hover { border-color: var(--highlight); transform: translateY(-2px); background-color: #f8f9fa; }
        .menu-card .icon { font-size: 30px; display: block; margin-bottom: 5px; }
        .menu-card .title { font-weight: bold; font-size: 14px; color: var(--primary-dark); }

        /* Vocab Table */
        .vocab-table { width: 100%; border-collapse: collapse; font-size: 15px; margin-bottom: 15px; }
        .vocab-table tr { border-bottom: 1px solid #eee; }
        .vocab-table td { padding: 10px 5px; vertical-align: middle; }
        .vocab-word { font-weight: bold; color: var(--highlight); font-size: 16px; }
        .vocab-read { font-size: 12px; color: #888; font-style: italic; display: block; margin-top: 2px; }
        .vocab-mean { text-align: right; font-weight: 500; }

        /* Content Box */
        .memory-box {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 15px;
        }

        /* Recommendation Box (Analysis Screen) */
        .recommend-box {
            background-color: #fff0f0;
            border: 2px dashed var(--wrong);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
        }
        .recommend-box h3 { margin-top: 0; color: var(--wrong); font-size: 18px; }
        .recommend-box p { color: #555; margin-bottom: 15px; }

        /* Quiz UI */
        .progress-bar { height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin-bottom: 10px; }
        .progress-fill { height: 100%; background: var(--correct); width: 0%; transition: width 0.3s; }
        .quiz-header { display: flex; justify-content: space-between; font-size: 13px; color: #7f8c8d; margin-bottom: 5px; }
        .question-box { font-size: 18px; font-weight: 600; color: var(--primary-dark); margin-bottom: 15px; line-height: 1.5; background: #f8f9fa; padding: 15px; border-radius: 10px; }
        
        .option-btn {
            background: white; border: 1px solid #ccc; padding: 12px 15px; border-radius: 10px; text-align: left; font-size: 16px; color: #444; cursor: pointer; transition: 0.1s; margin-bottom: 8px; position: relative;
        }
        .option-btn:hover { background-color: #f0f4f8; border-color: var(--highlight); }
        .option-btn.correct { background-color: #d4edda; border-color: var(--correct); color: #155724; }
        .option-btn.wrong { background-color: #f8d7da; border-color: var(--wrong); color: #721c24; opacity: 0.7; }

        .feedback { margin-top: 15px; padding: 15px; border-radius: 10px; background-color: #e8f4fd; border: 1px solid #b6e0fe; display: none; text-align: center; }
        .feedback.show { display: block; }
        .stat-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .stat-bad { color: var(--wrong); font-weight: bold; }
    </style>
</head>
<body>

<audio id="clickSound" src="click.mp3"></audio>

<div class="app-container">
    <div class="header">
        <h1>üëÆ Police Exam Master</h1>
        <p>‡∏ï‡∏¥‡∏ß‡∏™‡∏≠‡∏ö‡∏ô‡∏≤‡∏¢‡∏™‡∏¥‡∏ö‡∏ï‡∏≥‡∏£‡∏ß‡∏à (‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)</p>
    </div>

    <div class="content-area">

        <div class="screen active" id="mainMenu">
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 50px;">üöî</div>
                <h2 style="color: var(--primary-dark); margin: 10px 0;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
            </div>
            
            <button class="btn btn-start" onclick="playClick(); startRandomQuiz()">
                <span>üìù ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</span>
            </button>
            
            <div class="grid-menu" style="margin-top: 15px;">
                <div class="menu-card" onclick="playClick(); showScreen('learningMenu')">
                    <span class="icon">üìö</span>
                    <span class="title">‡∏Ñ‡∏•‡∏±‡∏á‡∏®‡∏±‡∏û‡∏ó‡πå & ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</span>
                </div>
                <div class="menu-card" onclick="playClick(); analyzeWeakness()">
                    <span class="icon">üìä</span>
                    <span class="title">‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <small onclick="clearData()" style="color:#aaa; cursor:pointer; text-decoration:underline;">‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</small>
            </div>
        </div>

        <div class="screen" id="learningMenu">
            <h3 style="margin-top:0;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ï‡∏¥‡∏ß</h3>
            <div class="grid-menu">
                <div class="menu-card" onclick="playClick(); showLesson('lesson-vocab')">
                    <span class="icon">üó£Ô∏è</span>
                    <span class="title">‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏≥‡∏£‡∏ß‡∏à (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ñ‡∏≥‡∏≠‡πà‡∏≤‡∏ô)</span>
                </div>
                <div class="menu-card" onclick="playClick(); showLesson('lesson-grammar')">
                    <span class="icon">‚è≥</span>
                    <span class="title">Grammar ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏π‡πâ</span>
                </div>
                <div class="menu-card" onclick="playClick(); showLesson('lesson-convo')">
                    <span class="icon">üí¨</span>
                    <span class="title">Conversation</span>
                </div>
                <div class="menu-card" onclick="playClick(); showLesson('lesson-tricks')">
                    <span class="icon">‚ö°</span>
                    <span class="title">‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏î‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥</span>
                </div>
            </div>
            <button class="btn btn-back" onclick="playClick(); showScreen('mainMenu')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div class="screen" id="lessonContent">
            
            <div id="lesson-vocab" class="lesson-detail" style="display:none;">
                <h3 style="border-bottom:2px solid var(--accent); padding-bottom:5px;">üõë ‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡∏≥‡∏£‡∏ß‡∏à & ‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</h3>
                <table class="vocab-table">
                    <tr><td><span class="vocab-word">Arrest</span><span class="vocab-read">‡∏≠‡∏∞-‡πÄ‡∏£‡∏™‡∏ó‡πå</span></td><td class="vocab-mean">‡∏à‡∏±‡∏ö‡∏Å‡∏∏‡∏°</td></tr>
                    <tr><td><span class="vocab-word">Suspect</span><span class="vocab-read">‡∏ã‡∏±‡∏™-‡πÄ‡∏õ‡∏Ñ‡∏ó‡πå</span></td><td class="vocab-mean">‡∏ú‡∏π‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏á‡∏™‡∏±‡∏¢</td></tr>
                    <tr><td><span class="vocab-word">Victim</span><span class="vocab-read">‡∏ß‡∏¥‡∏Ñ-‡∏ó‡∏¥‡∏°</span></td><td class="vocab-mean">‡πÄ‡∏´‡∏¢‡∏∑‡πà‡∏≠ / ‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</td></tr>
                    <tr><td><span class="vocab-word">Witness</span><span class="vocab-read">‡∏ß‡∏¥‡∏ó-‡πÄ‡∏ô‡∏™</span></td><td class="vocab-mean">‡∏û‡∏¢‡∏≤‡∏ô</td></tr>
                    <tr><td><span class="vocab-word">Evidence</span><span class="vocab-read">‡πÄ‡∏≠‡∏ü-‡∏ß‡∏¥-‡πÄ‡∏î‡∏ô‡∏ã‡πå</span></td><td class="vocab-mean">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô</td></tr>
                    <tr><td><span class="vocab-word">Investigation</span><span class="vocab-read">‡∏≠‡∏¥‡∏ô-‡πÄ‡∏ß‡∏™-‡∏ó‡∏¥-‡πÄ‡∏Å-‡∏ä‡∏±‡πà‡∏ô</span></td><td class="vocab-mean">‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏™‡∏ß‡∏ô</td></tr>
                    <tr><td><span class="vocab-word">Guilty</span><span class="vocab-read">‡∏Å‡∏¥‡∏•-‡∏ï‡∏µ‡πâ</span></td><td class="vocab-mean">‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î</td></tr>
                    <tr><td><span class="vocab-word">Innocent</span><span class="vocab-read">‡∏≠‡∏¥‡∏ô-‡πÇ‡∏ô-‡πÄ‡∏ã‡∏ô‡∏ó‡πå</span></td><td class="vocab-mean">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå</td></tr>
                    <tr><td><span class="vocab-word">Fine</span><span class="vocab-read">‡πÑ‡∏ü‡∏ô‡πå</span></td><td class="vocab-mean">‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö</td></tr>
                    <tr><td><span class="vocab-word">Custody</span><span class="vocab-read">‡∏Ñ‡∏±‡∏™-‡πÇ‡∏ï-‡∏î‡∏µ‡πâ</span></td><td class="vocab-mean">‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏±‡∏á</td></tr>
                </table>
                <h3 style="border-bottom:2px solid var(--highlight); padding-bottom:5px; margin-top:20px;">üìö ‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ö‡πà‡∏≠‡∏¢</h3>
                <table class="vocab-table">
                    <tr><td><span class="vocab-word">Essential</span><span class="vocab-read">‡πÄ‡∏≠‡∏™-‡πÄ‡∏ã‡∏ô-‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏•</span></td><td class="vocab-mean">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</td></tr>
                    <tr><td><span class="vocab-word">Deficiency</span><span class="vocab-read">‡∏î‡∏¥-‡∏ü‡∏¥-‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ô-‡∏ã‡∏µ‡πà</span></td><td class="vocab-mean">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≤‡∏î‡πÅ‡∏Ñ‡∏•‡∏ô</td></tr>
                    <tr><td><span class="vocab-word">Amass</span><span class="vocab-read">‡∏≠‡∏∞-‡πÅ‡∏°‡∏™</span></td><td class="vocab-mean">‡∏™‡∏∞‡∏™‡∏°</td></tr>
                </table>
            </div>

            <div id="lesson-grammar" class="lesson-detail" style="display:none;">
                <h3>‚è≥ Grammar & Tense</h3>
                <div class="memory-box">
                    <strong>1. Passive Voice (‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥):</strong><br>
                    ‡∏™‡∏π‡∏ï‡∏£: <span style="color:blue">V.to be + V.3</span><br>
                    - The thief <u>was arrested</u>.
                </div>
                <div class="memory-box">
                    <strong>2. If-Clause:</strong><br>
                    üî∏ <strong>‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</strong> If + V.1, ... will + V.1<br>
                    üî∏ <strong>‡∏ù‡∏±‡∏ô‡πÄ‡∏ü‡∏∑‡πà‡∏≠‡∏á:</strong> If + V.2, ... would + V.1<br>
                    <em>*‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏Å (If I were a bird) ‡πÉ‡∏ä‡πâ were ‡πÄ‡∏™‡∏°‡∏≠</em>
                </div>
                <div class="memory-box">
                    <strong>3. Keywords:</strong><br>
                    - <strong>Since / For</strong> ‚Üí Has/Have + V.3<br>
                    - <strong>Now</strong> ‚Üí is/am/are + ing<br>
                    - <strong>Ago</strong> ‚Üí V.2 (‡∏≠‡∏î‡∏µ‡∏ï)
                </div>
            </div>

            <div id="lesson-tricks" class="lesson-detail" style="display:none;">
                <h3>‚ö° ‡∏™‡∏π‡∏ï‡∏£‡∏•‡∏±‡∏î‡∏ä‡πà‡∏ß‡∏¢‡∏à‡∏≥</h3>
                <div class="memory-box">
                    <strong>üõë Stop: ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?</strong><br>
                    - <strong>Stop V.ing</strong> = ‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏≥‡∏ñ‡∏≤‡∏ß‡∏£ (Stop smoking)<br>
                    - <strong>Stop To V.1</strong> = ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô
                </div>
                <div class="memory-box">
                    <strong>üëÆ Make: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏Ñ‡∏£</strong><br>
                    - Make someone + <strong>V.pure</strong> (‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ to)<br>
                    - He made me <u>cry</u>.
                </div>
            </div>

            <div id="lesson-convo" class="lesson-detail" style="display:none;">
                <h3>üí¨ Conversation</h3>
                <div class="memory-box">
                    <strong>‚ùì Mind: ‡∏£‡∏±‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏à‡πÑ‡∏´‡∏°?</strong><br>
                    "Do you mind...?"<br>
                    ‚úÖ <strong>‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï:</strong> ‡∏ï‡∏≠‡∏ö "No, not at all"<br>
                    ‚ùå <strong>‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï:</strong> ‡∏ï‡∏≠‡∏ö "Yes" (‡∏£‡∏±‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏à)
                </div>
                <div class="memory-box">
                    <strong>üôè ‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</strong><br>
                    - May I see your ID card? (‡∏Ç‡∏≠‡∏î‡∏π‡∏ö‡∏±‡∏ï‡∏£)<br>
                    - Here you are. (‡∏ô‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ)
                </div>
            </div>

            <button class="btn btn-back" onclick="playClick(); showScreen('learningMenu')">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
        </div>

        <div class="screen" id="analysisScreen">
            <h3 style="text-align:center;">üìä ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô</h3>
            
            <div id="recommendationArea" class="recommend-box">
                <h3>‚ö†Ô∏è ‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡πÑ‡∏õ‡∏ï‡∏¥‡∏ß!</h3>
                <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î <strong id="weakPointName">...</strong> ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
                <button id="goToLessonBtn" class="btn btn-rec">üöÄ ‡πÑ‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ô‡∏µ‡πâ</button>
            </div>

            <div id="statContainer" style="background:white; border-radius:10px; padding:10px; border:1px solid #eee;">
                </div>
            
            <div id="noDataMsg" style="text-align:center; padding:20px; color:#999; display:none;">
                ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö<br>‡∏•‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö
            </div>
            
            <button class="btn btn-back" onclick="playClick(); showScreen('mainMenu')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
        </div>

        <div class="screen" id="quizScreen">
            <div class="quiz-header">
                <span id="qCategoryTag">‡∏´‡∏°‡∏ß‡∏î: Grammar</span>
                <span id="qCounter">1/15</span>
            </div>
            <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
            
            <div id="questionText" class="question-box">Loading...</div>
            
            <div id="optionsList">
                </div>

            <div id="feedback" class="feedback">
                </div>
            
            <button id="nextBtn" class="btn btn-next" onclick="playClick(); nextQuestion()">
                ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ûú
            </button>
        </div>

        <div class="screen" id="resultScreen">
            <div style="text-align: center; padding-top: 30px;">
                <div style="width: 100px; height: 100px; background: var(--primary-dark); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 32px; font-weight: bold; margin: 0 auto 20px;">
                    <span id="finalScore">0/15</span>
                </div>
                <h2 id="resultTitle">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h2>
                <p>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏õ‡∏î‡∏π‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞</p>
                
                <button class="btn btn-analysis" onclick="playClick(); analyzeWeakness()">
                    üìä ‡∏î‡∏π‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>
                <button class="btn btn-start" onclick="playClick(); startRandomQuiz()">
                    üîÑ ‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
                <button class="btn btn-back" onclick="playClick(); showScreen('mainMenu')">‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
        </div>

    </div>
</div>

<script>
    // --- Audio ---
    function playClick() {
        const audio = document.getElementById("clickSound");
        audio.currentTime = 0;
        audio.play().catch(e => {});
    }

    // --- Data: Question Bank ---
    const questionBank = [
        { q: "The thief ______ by the police yesterday.", options: ["arrests", "was arrested", "is arrested", "arrested"], answer: 1, note: "Passive Voice (‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥) ‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï‡πÉ‡∏ä‡πâ was + V.3", cat: "grammar" },
        { q: "If it rains tomorrow, I ______ at home.", options: ["stay", "will stay", "stayed", "would stay"], answer: 1, note: "If-Clause ‡πÅ‡∏ö‡∏ö 1: ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (will + V.1)", cat: "grammar" },
        { q: "If I ______ a bird, I would fly.", options: ["was", "am", "were", "been"], answer: 2, note: "If-Clause ‡πÅ‡∏ö‡∏ö 2: ‡∏™‡∏°‡∏°‡∏ï‡∏¥ (‡πÉ‡∏ä‡πâ were ‡∏Å‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô)", cat: "grammar" },
        { q: "Whenever she hears a sad story, she ______.", options: ["weeps", "will weep", "is weeping", "has wept"], answer: 0, note: "Whenever = ‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏¥‡∏™‡∏±‡∏¢ ‡πÉ‡∏ä‡πâ Present Simple (V.1)", cat: "grammar" },
        { q: "I know that he ______ right now.", options: ["works", "is working", "has worked", "worked"], answer: 1, note: "Right now = ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥ (is/am/are + ing)", cat: "grammar" },
        { q: "She has lived here ______ 10 years.", options: ["since", "for", "ago", "during"], answer: 1, note: "For + ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤...)", cat: "grammar" },
        { q: "We hunted for the pirate's buried ______.", options: ["treasure", "gloom", "brood", "evidence"], answer: 0, note: "Buried treasure = ‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ù‡∏±‡∏á", cat: "vocab" },
        { q: "The man was found ______ of robbery.", options: ["guilty", "sorry", "happy", "free"], answer: 0, note: "Guilty = ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î", cat: "vocab" },
        { q: "You must pay a ______ for illegal parking.", options: ["price", "fine", "cost", "money"], answer: 1, note: "Fine = ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö", cat: "vocab" },
        { q: "Police: 'May I see your ID?' <br> You: '______'", options: ["Yes, I do.", "Here you are.", "No, thank you.", "I am driving."], answer: 1, note: "‡∏¢‡∏∑‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î Here you are.", cat: "convo" },
        { q: "Do you mind if I sit here?", options: ["Yes, I do.", "No, not at all.", "Thank you.", "I am sorry."], answer: 1, note: "‡∏ñ‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö No, not at all (‡πÑ‡∏°‡πà‡∏£‡∏±‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏à)", cat: "convo" },
        { q: "I stop ______ cigarette.", options: ["smoking", "to smoke", "smokes", "smoke"], answer: 0, note: "Stop + ing = ‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏ñ‡∏≤‡∏ß‡∏£", cat: "tricks" },
        { q: "He made me ______.", options: ["to cry", "crying", "cry", "cried"], answer: 2, note: "Make someone + V.pure (‡πÑ‡∏°‡πà‡∏°‡∏µ to)", cat: "tricks" },
        { q: "A person who sees a crime is a ______.", options: ["suspect", "witness", "victim", "judge"], answer: 1, note: "Witness = ‡∏û‡∏¢‡∏≤‡∏ô", cat: "vocab" },
        { q: "What is the OPPOSITE of 'Innocent'?", options: ["Guilty", "Safe", "Kind", "Happy"], answer: 0, note: "Innocent (‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå) ‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏Å‡∏±‡∏ö Guilty (‡∏ú‡∏¥‡∏î)", cat: "vocab" }
    ];

    // --- State ---
    let currentQuizList = [];
    let currentIdx = 0;
    let score = 0;
    let canAnswer = true;
    let userStats = JSON.parse(localStorage.getItem('policeExamStats')) || { grammar:0, vocab:0, convo:0, tricks:0, totalWrong:0 };

    function saveStats() { localStorage.setItem('policeExamStats', JSON.stringify(userStats)); }
    function clearData() { 
        if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
            localStorage.removeItem('policeExamStats');
            userStats = { grammar:0, vocab:0, convo:0, tricks:0, totalWrong:0 };
            alert("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß");
            showScreen('mainMenu');
        }
    }

    // --- Navigation ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function showLesson(id) {
        document.querySelectorAll('.lesson-detail').forEach(l => l.style.display='none');
        document.getElementById(id).style.display='block';
        showScreen('lessonContent');
    }

    // --- Analysis Logic (Restored!) ---
    function analyzeWeakness() {
        showScreen('analysisScreen');
        const container = document.getElementById('statContainer');
        const noData = document.getElementById('noDataMsg');
        const recArea = document.getElementById('recommendationArea');
        
        if (userStats.totalWrong === 0) {
            container.innerHTML = "";
            recArea.style.display = 'none';
            noData.style.display = 'block';
            return;
        }
        noData.style.display = 'none';
        
        // 1. ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        const labels = { 'grammar':'Grammar', 'vocab':'‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå', 'convo':'‡∏™‡∏ô‡∏ó‡∏ô‡∏≤', 'tricks':'‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏≥' };
        const lessonMap = { 'grammar':'lesson-grammar', 'vocab':'lesson-vocab', 'convo':'lesson-convo', 'tricks':'lesson-tricks' };
        
        let maxWrong = -1;
        let weakKey = "";

        let html = "";
        Object.keys(labels).forEach(key => {
            const count = userStats[key];
            if(count > 0) {
                html += `<div class="stat-row"><span>${labels[key]}</span><span class="stat-bad">‡∏ú‡∏¥‡∏î ${count} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span></div>`;
            }
            if(count > maxWrong) {
                maxWrong = count;
                weakKey = key;
            }
        });
        container.innerHTML = html;

        // 2. ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î
        if (maxWrong > 0) {
            recArea.style.display = 'block';
            document.getElementById('weakPointName').innerText = labels[weakKey];
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏£‡πå‡∏õ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            const btn = document.getElementById('goToLessonBtn');
            btn.onclick = function() {
                playClick();
                showLesson(lessonMap[weakKey]);
            };
        } else {
            recArea.style.display = 'none';
        }
    }

    // --- Quiz Logic ---
    function startRandomQuiz() {
        currentQuizList = questionBank.sort(() => 0.5 - Math.random()).slice(0, 15);
        currentIdx = 0;
        score = 0;
        showScreen('quizScreen');
        loadQuestion();
    }

    function loadQuestion() {
        canAnswer = true;
        const q = currentQuizList[currentIdx];
        
        document.getElementById('qCounter').innerText = `${currentIdx + 1}/${currentQuizList.length}`;
        document.getElementById('qCategoryTag').innerText = `‡∏´‡∏°‡∏ß‡∏î: ${q.cat.toUpperCase()}`;
        document.getElementById('questionText').innerHTML = q.q;
        document.getElementById('progressFill').style.width = ((currentIdx / currentQuizList.length) * 100) + "%";
        
        document.getElementById('feedback').classList.remove('show');
        document.getElementById('nextBtn').style.display = 'none';

        const list = document.getElementById('optionsList');
        list.innerHTML = '';
        
        q.options.forEach((opt, index) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => checkAnswer(index, btn);
            list.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, btnElement) {
        if (!canAnswer) return;
        canAnswer = false;
        playClick();

        const q = currentQuizList[currentIdx];
        const feedback = document.getElementById('feedback');
        const allBtns = document.querySelectorAll('.option-btn');

        if (selectedIndex === q.answer) {
            score++;
            btnElement.classList.add('correct');
            feedback.innerHTML = `<span style='color:#155724; font-weight:bold;'>‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</span><br>${q.note}`;
        } else {
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
            userStats[q.cat]++;
            userStats.totalWrong++;
            saveStats();
            
            btnElement.classList.add('wrong');
            allBtns[q.answer].classList.add('correct');
            feedback.innerHTML = `<span style='color:#721c24; font-weight:bold;'>‚ùå ‡∏ú‡∏¥‡∏î! ‡∏ï‡∏≠‡∏ö: ${q.options[q.answer]}</span><br>${q.note}`;
        }
        feedback.classList.add('show');
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        document.getElementById('nextBtn').style.display = 'block';
    }

    function nextQuestion() {
        currentIdx++;
        if (currentIdx < currentQuizList.length) {
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    function finishQuiz() {
        showScreen('resultScreen');
        document.getElementById('finalScore').innerText = `${score}/${currentQuizList.length}`;
        const pct = (score / currentQuizList.length) * 100;
        document.getElementById('resultTitle').innerText = pct >= 80 ? "‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î!" : pct >= 50 ? "‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå" : "‡∏™‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ!";
    }

    showScreen('mainMenu');
</script>

</body>
</html>