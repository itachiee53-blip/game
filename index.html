<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday My Love</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Mali', cursive;
            overflow: hidden;
            height: 100vh;
            background: linear-gradient(-45deg, #ff9a9e, #fad0c4, #ffd1ff, #a18cd1);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #555;
            user-select: none;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- 1. ‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ --- */
        #envelope-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: opacity 1s;
        }

        .envelope-container {
            position: relative;
            width: 300px;
            height: auto;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .envelope-container:active { transform: scale(0.95); }

        .envelope-closed, .envelope-open {
            width: 100%;
            display: block;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
            transition: opacity 0.5s;
        }
        
        .envelope-open {
            position: absolute;
            top: 0; left: 0;
            opacity: 0;
        }

        .envelope-container.is-open .envelope-closed { opacity: 0; }
        .envelope-container.is-open .envelope-open { opacity: 1; }

        .tap-hint-envelope {
            margin-top: 30px;
            color: white;
            font-size: 1.2rem;
            animation: pulse 1.5s infinite;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* --- 2. ‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏π‡∏£‡∏π‡∏õ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á) --- */
        #slide-container {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏´‡∏¥‡∏á‡∏´‡πâ‡∏≠‡∏¢ */
        .firefly {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            animation: floatFirefly 5s ease-in-out infinite alternate;
        }

        @keyframes floatFirefly {
            0% { transform: translate(0, 0); opacity: 0.2; }
            100% { transform: translate(20px, -40px); opacity: 0.9; }
        }

        .card {
            width: 85%;
            max-width: 380px;
            background: white;
            padding: 15px;
            padding-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            
            /* ‚≠ê ‡πÉ‡∏™‡πà‡∏Ñ‡∏∑‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö: ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á ‚≠ê */
            position: absolute;
            top: 50%; 
            left: 50%;
            /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠ (-50%, -50%) + ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡πÑ‡∏•‡∏î‡πå */
            transform: translate(-50%, -50%) rotate(-10deg) translateX(-100px);
            
            display: none; 
            flex-direction: column;
            max-height: 75vh;
            
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 10;
        }
        
        .card.active { 
            display: flex;
            opacity: 1; 
            /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ active ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢ JS ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        }

        .card img { 
            width: 100%; 
            height: auto; 
            max-height: 45vh; 
            object-fit: cover; 
            border-radius: 10px;
            flex-shrink: 0;
        }

        .caption { 
            margin-top: 15px; 
            text-align: center;
            overflow-y: auto;
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .caption::-webkit-scrollbar { display: none; }

        .tap-hint-slide {
            position: fixed;
            bottom: 30px;
            left: 0;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 1rem;
            opacity: 0.8;
            animation: pulse 2s infinite;
            z-index: 100;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            pointer-events: none;
        }

        /* --- 3. ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏Ñ‡πâ‡∏Å --- */
        #cake-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: relative;
        }
        .cake-container { position: relative; width: 300px; cursor: pointer; margin-top: -50px; }
        .cake-img { width: 100%; transition: transform 0.1s; }
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .breath-meter { width: 80%; max-width: 300px; height: 20px; background: rgba(255,255,255,0.5); border-radius: 10px; margin-top: 20px; overflow: hidden; border: 2px solid white; display: none; }
        .breath-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #ff9a9e, #ff6b81); transition: width 0.1s; }
        .instruction-text { color: white; font-size: 1.5rem; margin-top: 20px; text-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; animation: bounce 2s infinite; }

        /* --- 4. Modal ‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£ --- */
        #wish-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 100; justify-content: center; align-items: center; animation: fadeIn 0.5s; }
        .modal-content { background: white; width: 85%; max-width: 350px; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); transform: scale(0.8); animation: popIn 0.3s forwards; }
        input[type="text"] { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #ffd1ff; border-radius: 10px; font-family: 'Mali', cursive; font-size: 1.1rem; text-align: center; outline: none; }
        input[type="text"]:focus { border-color: #ff6b81; }
        .btn-confirm { background: #ff6b81; color: white; border: none; padding: 12px 30px; font-size: 1.2rem; border-radius: 50px; cursor: pointer; font-family: 'Mali', cursive; transition: transform 0.2s; }
        .btn-confirm:hover { transform: scale(1.05); background: #ff4757; }
        .final-msg { display: none; font-size: 2rem; color: #fff; text-shadow: 2px 2px 0 #ff6b81; margin-top: 20px; text-align: center; line-height: 1.5; animation: popIn 1s; }
        .user-wish { color: #ffffdd; font-size: 1.5rem; margin-top: 10px; display: block; }

        /* Animations */
        @keyframes pulse { 50% { opacity: 0.5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #fireworks { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99; }
    </style>
</head>
<body>

    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <canvas id="fireworks"></canvas>

    <div id="envelope-screen">
        <div class="envelope-container" onclick="openEnvelope()">
            <img src="image_4.png" alt="‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏¥‡∏î" class="envelope-closed">
            <img src="image_5.png" alt="‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡∏¥‡∏î" class="envelope-open">
        </div>
        <div class="tap-hint-envelope">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢ üíå</div>
    </div>

    <div id="slide-container" onclick="nextSlide()">
        <div id="card-wrapper"></div>
        <div class="tap-hint-slide">
            (‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡πà‡∏≠)
        </div>
    </div>

    <div id="cake-screen">
        <div class="cake-container" onclick="tapToBlow()">
            <img id="cake-img" src="cake_lit.jpg" class="cake-img" alt="‡πÄ‡∏Ñ‡πâ‡∏Å">
        </div>
        <div class="breath-meter" id="breath-meter">
            <div class="breath-fill" id="breath-fill"></div>
        </div>
        <div class="instruction-text" id="cake-hint">
            ‡∏ä‡πà‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏Ñ‡πâ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢!<br>
            <span style="font-size:1rem;">(‡∏Å‡∏î‡∏¢‡πâ‡∏≥‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡πâ‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏£‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏•‡∏≠‡∏î)</span>
        </div>
        <div class="final-msg" id="final-msg">
            Happy Birthday! üéÇ<br>
            <span id="show-wish" class="user-wish"></span>
        </div>
    </div>

    <div id="wish-modal">
        <div class="modal-content">
            <h2 style="color:#ff6b81;">Make a Wish! ‚ú®</h2>
            <p style="color:#555;">‡∏≠‡∏ò‡∏¥‡∏©‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏û‡∏£‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ...</p>
            <input type="text" id="wish-input" placeholder="‡∏Ç‡∏≠‡πÉ‡∏´‡πâ...">
            <button class="btn-confirm" onclick="submitWish()">‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏•‡∏¢! üå¨Ô∏è</button>
        </div>
    </div>

    <script>
        // ==========================================
        //  üëá ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° üëá
        // ==========================================
        const slides = [
            { 
                img: "gf1.jpg", 
                title: "HBD.üéÇ 11/02/2026", 
                text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏ô‡πâ‡∏≤ ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÑ‡∏õ‡∏â‡∏•‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏ï‡πà‡πÄ‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ó‡∏≥‡πÄ‡∏ß‡πá‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏•‡∏¢" 
            },
            { 
                img: "gf2.jpg", 
                title: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ô‡∏∞ ü´∂üåπ", 
                text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÜ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÜ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ò‡∏≠‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡∏Å‡πá‡∏à‡∏∞‡∏Ñ‡∏≠‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏°‡∏≠...‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡πÅ‡∏ü‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏°‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢" 
            },
            { 
                img: "gf3.jpg", 
                title: "‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏∞(‡πÄ‡∏î‡πá‡∏Å‡∏≠‡πâ‡∏ß‡∏ô)", 
                text: "‡∏ñ‡∏∂‡∏á‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ò‡∏≠‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏û‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏¥‡∏î‡∏°‡∏≤‡∏Å...‡∏≠‡∏¢‡πà‡∏≤‡πÑ‡∏õ‡∏Å‡∏î‡∏î‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÉ‡∏ô‡∏ï‡∏±‡∏≠‡∏á‡πÄ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡πâ‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ü‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏°‡∏≤‡∏Å‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏™‡∏≠‡∏ö ‡∏ô‡∏™‡∏ï.‡∏î‡πâ‡∏ß‡∏¢555 ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≠‡∏ö‡∏û‡∏•‡∏∞‡∏™‡∏π‡πâ‡πÇ‡∏ß‡πâ‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡πÄ‡∏ò‡∏≠‡∏î‡πâ‡∏ß‡∏¢!! ‡∏£‡∏±‡∏Å‡∏ô‡∏∞‡πÄ‡∏î‡πá‡∏Å‡∏≠‡πâ‡∏ß‡∏ôüß∏üíï " 
            }
        ];
        const totalTapsNeeded = 15; 
        // ==========================================

        const bgm = document.getElementById('bgm');
        const envelopeScreen = document.getElementById('envelope-screen');
        const envelopeContainer = document.querySelector('.envelope-container');
        const slideContainer = document.getElementById('slide-container');
        const cardWrapper = document.getElementById('card-wrapper');
        const cakeScreen = document.getElementById('cake-screen');
        const cakeImg = document.getElementById('cake-img');
        const breathMeter = document.getElementById('breath-meter');
        const breathFill = document.getElementById('breath-fill');
        const cakeHint = document.getElementById('cake-hint');
        const wishModal = document.getElementById('wish-modal');
        const tapHintSlide = document.querySelector('.tap-hint-slide');
        
        let currentIndex = 0;
        let tapCount = 0;
        let isBlowing = false;

        // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Slideshow
        let cardHTML = '';
        slides.forEach((slide, index) => {
            cardHTML += `
                <div class="card" id="card-${index}">
                    <img src="${slide.img}" alt="Photo">
                    <div class="caption">
                        <div style="font-size: 1.6rem; color: #ff6b81; margin-bottom: 8px; font-weight: bold; line-height: 1.6; padding-top: 10px;">${slide.title}</div>
                        <div style="font-size: 0.95rem; color: #555; line-height: 1.5;">${slide.text}</div>
                    </div>
                </div>
            `;
        });
        cardWrapper.innerHTML = cardHTML;

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏¥‡∏á‡∏´‡πâ‡∏≠‡∏¢ ---
        function createFireflies() {
            const container = document.getElementById('slide-container');
            for (let i = 0; i < 20; i++) {
                let f = document.createElement('div');
                f.className = 'firefly';
                let size = Math.random() * 4 + 2; 
                f.style.width = size + 'px';
                f.style.height = size + 'px';
                f.style.left = Math.random() * 100 + '%';
                f.style.top = Math.random() * 100 + '%';
                f.style.animationDuration = (Math.random() * 3 + 3) + 's';
                f.style.animationDelay = (Math.random() * 2) + 's';
                container.appendChild(f);
            }
        }

        // --- Step 1: ‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á ---
        function openEnvelope() {
            bgm.volume = 0.5;
            bgm.play().catch(e => console.log("Audio Error"));
            document.querySelector('.tap-hint-envelope').style.display = 'none';
            envelopeContainer.classList.add('is-open');

            setTimeout(() => {
                envelopeScreen.style.opacity = 0;
                setTimeout(() => {
                    envelopeScreen.style.display = 'none';
                    slideContainer.style.display = 'block';
                    tapHintSlide.style.display = 'block'; 
                    createFireflies();
                    showCard(0);
                }, 1000);
            }, 1500);
        }

        // --- Step 2: ‡∏î‡∏π‡∏£‡∏π‡∏õ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏≤‡∏á‡πÄ‡∏õ‡πä‡∏∞) ---
        function showCard(index) {
            const card = document.getElementById(`card-${index}`);
            if(card) {
                card.classList.add('active');
                // ‚≠ê ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ translate(-50%, -50%) ‡πÄ‡∏™‡∏°‡∏≠ ‚≠ê
                card.style.transform = `translate(-50%, -50%) rotate(${Math.random() * 4 - 2}deg)`;
            }
        }

        function nextSlide() {
            if (currentIndex < slides.length - 1) {
                const oldCard = document.getElementById(`card-${currentIndex}`);
                oldCard.style.transform = "translate(-50%, -50%) translateY(-100px) rotate(10deg)";
                oldCard.style.opacity = 0;
                currentIndex++;
                setTimeout(() => { showCard(currentIndex); }, 300);
            } else {
                slideContainer.style.opacity = 0;
                tapHintSlide.style.display = 'none'; 
                setTimeout(() => {
                    slideContainer.style.display = 'none';
                    cakeScreen.style.display = 'flex';
                }, 800);
            }
        }

        // --- Step 3: ‡πÄ‡∏õ‡πà‡∏≤‡πÄ‡∏Ñ‡πâ‡∏Å ---
        function tapToBlow() {
            if (isBlowing) return;
            breathMeter.style.display = 'block';
            tapCount++;
            cakeImg.classList.remove('shake');
            void cakeImg.offsetWidth;
            cakeImg.classList.add('shake');
            let percentage = (tapCount / totalTapsNeeded) * 100;
            if (percentage > 100) percentage = 100;
            breathFill.style.width = percentage + "%";
            if (tapCount >= totalTapsNeeded) {
                isBlowing = true;
                setTimeout(() => {
                    wishModal.style.display = 'flex';
                }, 500);
            }
        }

        // --- Step 4: ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£ ---
        function submitWish() {
            const wishText = document.getElementById('wish-input').value;
            if (wishText.trim() === "") {
                alert("‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏£‡πá‡∏ß‡∏ß‡∏ß üëá");
                return;
            }
            wishModal.style.display = 'none';
            cakeImg.src = "cake_off.jpg"; 
            breathMeter.style.display = 'none';
            cakeHint.style.display = 'none';
            const finalMsg = document.getElementById('final-msg');
            document.getElementById('show-wish').innerText = `"${wishText}"`;
            finalMsg.style.display = 'block';
            startFireworks();
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏•‡∏∏ ---
        function startFireworks() {
            const canvas = document.getElementById('fireworks');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            let particles = [];
            function createFirework(x, y) {
                const count = 100;
                const colors = ['#ff7675', '#74b9ff', '#55efc4', '#ffeaa7', '#a29bfe'];
                for (let i = 0; i < count; i++) {
                    const speed = Math.random() * 5 + 2;
                    const angle = Math.random() * Math.PI * 2;
                    particles.push({
                        x: x, y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        life: 1,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        size: Math.random() * 3 + 1
                    });
                }
            }
            setInterval(() => {
                createFirework(Math.random() * canvas.width, Math.random() * canvas.height * 0.5);
            }, 800);
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let i = 0; i < particles.length; i++) {
                    let p = particles[i];
                    p.x += p.vx; p.y += p.vy; p.vy += 0.05; p.life -= 0.01;
                    ctx.globalAlpha = p.life; ctx.fillStyle = p.color; ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                    if(p.life <= 0) particles.splice(i,1);
                }
                requestAnimationFrame(animate);
            }
            animate();
            createFirework(canvas.width/2, canvas.height/3);
        }
    </script>
</body>
</html>